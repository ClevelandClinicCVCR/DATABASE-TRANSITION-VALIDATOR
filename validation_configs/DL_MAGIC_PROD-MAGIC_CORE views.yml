# Database Transition Validation Configuration
#
# This file contains table mappings for validating data migration
# from Teradata to MS SQL Server.
database_setting:
  source_database:
    type: "Teradata" # Teradata, MS_SQL_Server
    index: 0 # Index (start from 0) of the database type in database_credentials_local.yml. Null or -1 means don't use index value, use name instead.
    name: "Teradata" # If index is null or -1, use name to identify the database credentials in database_credentials_local.yml
    # if both index and name are provided, index will be used.
    # if none of index and name is provided, the first entry (index 0) will be used.
    schema: "DL_MAGIC_PROD" # DL_MAGIC_DEV, DL_MAGIC_PROD (for Teradata). MAGIC_CORE, PYTHIA_CORE, dbo (for MS_SQL_Server)

  target_database:
    type: "MS_SQL_Server" # Teradata, MS_SQL_Server
    index: 0 # Index (start from 0) of the database type in database_credentials_local.yml. Null or -1 means don't use index value, use name instead.
    name: "MS_SQL_Server_DEV" # If index is null or -1, use name to identify the database credentials in database_credentials_local.yml
    # if none of index and name is provided, the first entry (index 0) will be used.
    schema: "MAGIC_CORE" # MAGIC_CORE, PYTHIA_CORE, dbo (for MS_SQL_Server). DL_MAGIC_DEV, DL_MAGIC_PROD (for Teradata)

table_mappings:
  # - source_table: "TRIAL" # test to add a random table
  #   key_columns: ["NCT_ID", "PRMC_ID", "TRIAL_TITLE"]

  - source_table: "BIOMARKER_V"
    key_columns: ["BIOMARKER", "HUGO_SYMBOL"]

  - source_table: "CANCER_DIAGNOSIS_V"
    key_columns: ["SITE_CODE", "SITE_CODE_PREFIX", "MORPHOLOGY_CODE"]

  - source_table: "DIAGNOSIS_BREAST_CANCER_PATIENTS_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "ICD_O_SITE_CODE", "ICD_O_SITE_CODE_PREFIX", "ICD_O_MORPHOLOGY_CODE", "DIAGNOSIS_SOURCE"]

  - source_table: "DIAGNOSIS_COLORECTAL_CANCER_PATIENTS_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "ICD_O_SITE_CODE", "ICD_O_SITE_CODE_PREFIX", "ICD_O_MORPHOLOGY_CODE", "DIAGNOSIS_SOURCE"]

  - source_table: "DIAGNOSIS_GASTROINTESTINAL_CANCER_PATIENTS_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "ICD_O_SITE_CODE", "ICD_O_SITE_CODE_PREFIX", "ICD_O_MORPHOLOGY_CODE", "DIAGNOSIS_SOURCE"]

  - source_table: "DIAGNOSIS_LUNG_CANCER_PATIENTS_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "ICD_O_SITE_CODE", "ICD_O_SITE_CODE_PREFIX", "ICD_O_MORPHOLOGY_CODE", "DIAGNOSIS_SOURCE"]

  - source_table: "NGS_CNV_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "HUGO_SYMBOL", "BIOMARKER", "ASSAY_RESULT","NUMERIC_VALUE"]

  - source_table: "NGS_ER_PR_HER2_NEU_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "ASSAY_RESULT", "NUMERIC_VALUE"]

  - source_table: "NGS_FOLFOX_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "ASSAY_RESULT", "NUMERIC_VALUE"]

  - source_table: "NGS_FUSION_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "NO_CHANGE_DETECTED", "GENE_1_HUGO_SYMBOL", "GENE_1_EXON", "GENE_1_REFSEQ", "GENE_1_CHROMOSOME", "GENE_1_START_POSITION", "GENE_1_STRAND", "GENE_2_HUGO_SYMBOL", "GENE_2_EXON", "GENE_2_REFSEQ", "GENE_2_CHROMOSOME", "GENE_2_START_POSITION", "GENE_2_STRAND"]

  - source_table: "NGS_GLOBAL_ALTERATION_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "GLOBAL_ALTERATION_TYPE", "ASSAY_RESULT", "NUMERIC_VALUE"]

  - source_table: "NGS_HRD_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "ASSAY_RESULT", "NUMERIC_VALUE"]

  - source_table: "NGS_HRR_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "ASSAY_RESULT", "NUMERIC_VALUE"]

  - source_table: "NGS_IHC_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "PROTEIN_ALIAS", "BIOMARKER", "HUGO_SYMBOL", "ASSAY_RESULT", "INTENSITY", "PERCENTAGE"]

  - source_table: "NGS_LOH_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "ASSAY_RESULT", "NUMERIC_VALUE"]

  - source_table: "NGS_MMR_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "ASSAY_RESULT", "NUMERIC_VALUE"]

  - source_table: "NGS_MSI_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "ASSAY_RESULT", "NUMERIC_VALUE"]

  - source_table: "NGS_SNV_CLASSIFICATION_TRANSLATION_V"
    key_columns: ["CLASSIFICATION_GROUP_NAME", "SOURCE_CLASSIFICATION_STRING", "MAGIC_CLASSIFICATION"]

  - source_table: "NGS_SNV_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "HUGO_SYMBOL", "BIOMARKER", "NCBI_BUILD", "CHROMOSOME", "START_POSITION", "END_POSITION", "STRAND", "CLASSIFICATION", "TYPE", "REFERENCE_ALLELE", "TUMOR_SEQ_ALLELE1", "TUMOR_SEQ_ALLELE2", "HGVSC", "HGVSP_SHORT", "EXON", "T_REF_COUNT", "T_ALT_COUNT", "VARIANT_ALLELE_FREQUENCY", "GENOTYPE", "IS_VARIANT_OF_UNKNOWN_SIGNIFICANCE", "IS_WILD_TYPE"]

  - source_table: "NGS_TEST_RESULT_COUNT_BY_PANEL_V"
    key_columns: ["SOURCE_NAME", "PANEL_CODE", "PANEL_NAME", "RECORD_COUNT"]

  - source_table: "NGS_TEST_RESULT_COUNT_BY_SOURCE_V"
    key_columns: ["SOURCE_NAME", "RECORD_COUNT"]

  - source_table: "NGS_TEST_RESULT_DAILY_COUNT_V"
    key_columns: ["PIPELINE"]

  - source_table: "NGS_TEST_RESULT_METADATA_V"
    key_columns: ["ACCESSION_NUMBER"]

  - source_table: "NGS_TEST_RESULT_SOURCE_MATCH_RATE_V"
    key_columns: ["SOURCE_NAME"]

  - source_table: "NGS_TEST_RESULT_V"
    key_columns: ["ACCESSION_NUMBER", "PAT_ID", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "SOURCE", "PANEL_CODE", "PATHOLOGY_CASE_NUMBER"]

  - source_table: "NGS_TEST_RESULT_WEEKLY_COUNT_V"
    key_columns: ["PIPELINE"]

  - source_table: "NGS_TMB_V"
    key_columns: ["ACCESSION_NUMBER", "MRN", "PATIENT_FIRST_NAME", "PATIENT_LAST_NAME", "NUMERIC_VALUE"]

  - source_table: "PATIENT_CANCER_DIAGNOSIS_CODE_COUNT_V"
    key_columns: ["DIAGNOSIS_SOURCE"]

  - source_table: "PATIENT_CANCER_DIAGNOSIS_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "VITAL_STATUS", "LAST_ENCOUNTER_DATE", "ICD_O_SITE_CODE", "ICD_O_SITE_CODE_PREFIX", "ICD_O_MORPHOLOGY_CODE", "DIAGNOSIS_SOURCE"]

  - source_table: "PATIENT_DATA_AVAILABILITY_V"
    key_columns: ["LABEL"]

  - source_table: "PATIENT_LAB_RESULT_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "LAB_NAME", "LAB_RESULT"]

  - source_table: "PATIENT_TREATMENT_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "TREATMENT", "TREATMENT_TYPE"]

  - source_table: "PATIENT_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "VITAL_STATUS", "SEX_ASSIGNED_AT_BIRTH", "RACE", "ETHNICITY", "ECOG_PERFORMANCE_STATUS"]

  - source_table: "PROTEIN_ALIAS_V"
    key_columns: ["PROTEIN_ALIAS", "HUGO_SYMBOL"]

  - source_table: "SOURCE_PANEL_VERSION_V"
    key_columns: ["SOURCE_NAME", "PANEL_CODE", "PANEL_VERSION"]

  - source_table: "SPECIMEN_V"
    key_columns: ["PAT_ID", "PAT_EPI_ID", "MRN", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH", "SPEC_NUMBER_LN1", "PART", "SPECIMEN_TYPE"]

  - source_table: "TREATMENT_EDV_TRANSLATION_V"
    key_columns: ["MAGIC_TREATMENT_NAME", "ALTERNATE_TREATMENT_NAME", "EDV_TREATMENT_NAME"]

  - source_table: "TREATMENT_V"
    key_columns: ["TREATMENT", "TREATMENT_TYPE"]

  - source_table: "TRIAL_ARM_V"
    key_columns: ["NCT_ID", "CCF_IRB_ID", "PRMC_ID", "TRIAL_TITLE", "STATUS"]

  - source_table: "TRIAL_CONTACT_V"
    key_columns: ["NCT_ID", "PRMC_ID", "TRIAL_TITLE", "FIRST_NAME", "LAST_NAME"]

  - source_table: "TRIAL_DATA_AVAILABILITY_V"
    key_columns: ["LABEL"]

  - source_table: "TRIAL_INGEST_LOG_V"
    key_columns: ["NCT_ID"]

  - source_table: "TRIAL_LOCATION_V"
    key_columns: ["NCT_ID", "PRMC_ID", "TRIAL_TITLE", "LOCATION_NAME"]

  - source_table: "TRIAL_V"
    key_columns: ["NCT_ID", "PRMC_ID", "TRIAL_TITLE", "PHASES"]

  - source_table: "UNMATCHED_NGS_TEST_RESULT_V"
    key_columns: ["ACCESSION_NUMBER", "SOURCE", "PANEL"]

  - source_table: "URGENT_LOGS_LAST_TWO_DAYS_V"
    key_columns: ["PIPELINE"]

# Validation Settings
validation_settings:
  output_dir: "database_validation_reports"

  # Maximum number of parallel workers
  max_workers: 2

  # Sample size for data validation (null or 0 = all data)
  sample_size: null

  data_validation_threshold:
    success: 99.0  # Threshold for success rate (percentage)
    warning: 95.0  # Threshold for warning (percentage)

  row_count_difference_threshold:
    success: 1.0   # Threshold for success rate (percentage)
    warning: 5.0   # Threshold for warning (percentage)

  # Enable/disable specific validation types
  enable_schema_validation: true
  enable_data_validation: true
  enable_constraint_validation: false  # Future feature

  # Timeout settings (seconds)
  query_timeout: 300
  connection_timeout: 30
