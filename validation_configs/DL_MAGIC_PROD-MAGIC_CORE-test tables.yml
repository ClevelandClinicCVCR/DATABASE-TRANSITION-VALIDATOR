# Database Transition Validation Configuration
#
# This file contains table mappings for validating data migration
# from Teradata to MS SQL Server.
database_setting:
  source_database:
    type: "Teradata" # Teradata, MS_SQL_Server
    index: 0 # Index (start from 0) of the database type in database_credentials_local.yml. Null or -1 means don't use index value, use name instead.
    name: "Teradata" # If index is null or -1, use name to identify the database credentials in database_credentials_local.yml
    # if both index and name are provided, index will be used.
    # if none of index and name is provided, the first entry (index 0) will be used.
    schema: "DL_MAGIC_PROD" # DL_MAGIC_DEV, DL_MAGIC_PROD (for Teradata). MAGIC_CORE, PYTHIA_CORE, dbo (for MS_SQL_Server)

  target_database:
    type: "MS_SQL_Server" # Teradata, MS_SQL_Server
    name: "MS_SQL_Server_DEV"
    schema: "MAGIC_CORE" # MAGIC_CORE, PYTHIA_CORE, dbo (for MS_SQL_Server). DL_MAGIC_DEV, DL_MAGIC_PROD (for Teradata)

table_mappings:
  - source_table: "NGS_CNV"
    group: "NGS_CNV"
    key_columns: ["NUMERIC_VALUE", "REFSEQ", "IS_VARIANT_OF_UNKNOWN_SIGNIFICANCE -> int", "IS_WILD_TYPE -> int", "IS_INHERITED -> int", "IS_PATHOGENIC -> int", "IS_ACTIONABLE -> int", "IS_LOW_COVERAGE_AMPLICON -> int"]
    data_transformation_rules: ["normalize_null_nan"]
    rule_based_data_validation:
      NUMERIC_VALUE:
        pattern: "^\\d+(\\.\\d+)?$"
        pattern_regex_description: "One or more digits (0-9) followed by an optional decimal point and more digits"
        nullable: true # can be null
      IS_VARIANT_OF_UNKNOWN_SIGNIFICANCE:
        pattern: "^(0|1|[Tt]rue|[Ff]alse)$"
        pattern_regex_description: "Binary values: 0, 1, true, false"
        nullable: true # can be null
      IS_WILD_TYPE:
        pattern: "^(0|1|[Tt]rue|[Ff]alse)$"
        pattern_regex_description: "Binary values: 0, 1, true, false"
        nullable: true # can be null
      IS_INHERITED:
        pattern: "^(0|1|[Tt]rue|[Ff]alse)$"
        pattern_regex_description: "Binary values: 0, 1, true, false"
        nullable: true # can be null
      IS_PATHOGENIC:
        pattern: "^(0|1|[Tt]rue|[Ff]alse)$"
        pattern_regex_description: "Binary values: 0, 1, true, false"
        nullable: true # can be null
      IS_ACTIONABLE:
        pattern: "^(0|1|[Tt]rue|[Ff]alse)$"
        pattern_regex_description: "Binary values: 0, 1, true, false"
        nullable: true # can be null
      IS_LOW_COVERAGE_AMPLICON:
        pattern: "^(0|1|[Tt]rue|[Ff]alse)$"
        pattern_regex_description: "Binary values: 0, 1, true, false"
        nullable: true # can be null
    distribution_based_data_validation:
      IS_VARIANT_OF_UNKNOWN_SIGNIFICANCE:
        expected_distribution:
          "0":
            min_count: 1
            max_count: 200
            min_percent: 10.0
            max_percent: 40.0
          "1":
            min_count: 2  # VUS may have some “1” values for CNV from Caris's report
      IS_WILD_TYPE:
        expected_distribution:
          "0":
            min_count: 100
            max_count: 300
            min_percent: 40.0
          "1":
            min_count: 1
      IS_INHERITED:
        expected_distribution:
          "1":
            min_count: 1
      IS_PATHOGENIC:
        expected_distribution:
          "1":
            min_count: 1
      IS_ACTIONABLE:
        expected_distribution:
          "1":
            min_count: 1
            max_percent: 10.0
      IS_LOW_COVERAGE_AMPLICON:
        expected_distribution:
          "1":
            min_count: 1

# Validation Settings
validation_settings:
  output_dir: "database_validation_reports"

  # Maximum number of parallel workers
  max_workers: 2

  # Sample size for data validation (null or 0 = all data)
  sample_size: 1_000

  data_validation_threshold:
    success: 99.0  # Threshold for success rate (percentage)
    warning: 95.0  # Threshold for warning (percentage)

  row_count_difference_threshold:
    success: 1.0   # Threshold for success rate (percentage)
    warning: 5.0   # Threshold for warning (percentage)

  # Enable/disable specific validation types
  enable_schema_validation: false
  enable_data_validation: true
  enable_rule_based_data_validation: true
  enable_distribution_based_data_validation: true
