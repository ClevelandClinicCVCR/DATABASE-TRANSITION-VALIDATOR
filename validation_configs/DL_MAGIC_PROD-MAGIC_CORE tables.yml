# Database Transition Validation Configuration
#
# This file contains table mappings for validating data migration
# from Teradata to MS SQL Server.
database_setting:
  source_database:
    type: "Teradata" # Teradata, MS_SQL_Server
    index: 0 # Index (start from 0) of the database type in database_credentials_local.yml. Null or -1 means don't use index value, use name instead.
    name: "Teradata" # If index is null or -1, use name to identify the database credentials in database_credentials_local.yml
    # if both index and name are provided, index will be used.
    # if none of index and name is provided, the first entry (index 0) will be used.
    schema: "DL_MAGIC_PROD" # DL_MAGIC_DEV, DL_MAGIC_PROD (for Teradata). MAGIC_CORE, PYTHIA_CORE, dbo (for MS_SQL_Server)

  target_database:
    type: "MS_SQL_Server" # Teradata, MS_SQL_Server
    index: 0 # Index (start from 0) of the database type in database_credentials_local.yml. Null or -1 means don't use index value, use name instead.
    name: "MS_SQL_Server_DEV" # If index is null or -1, use name to identify the database credentials in database_credentials_local.yml
    # if none of index and name is provided, the first entry (index 0) will be used.
    schema: "MAGIC_CORE" # MAGIC_CORE, PYTHIA_CORE, dbo (for MS_SQL_Server). DL_MAGIC_DEV, DL_MAGIC_PROD (for Teradata)

table_mappings:
  # Patient Tables
  - source_table: "PATIENT"
    target_table: "PATIENT"
    key_columns: ["PAT_ID", "PAT_MRN_ID", "FIRST_NAME", "LAST_NAME", "DATE_OF_BIRTH"]

  - source_table: "PATIENT_CANCER_DIAGNOSIS"
    key_columns: ["CONFIDENCE_PERCENTAGE"]

  - source_table: "PATIENT_CLINICAL_CANCER_STAGE"
  - source_table: "PATIENT_ECOG_PERFORMANCE_STATUS"
    key_columns: ["ECOG_TIMESTAMP"]

  - source_table: "PATIENT_LAB_RESULT"
    key_columns: ["RESULT_VALUE", "RESULT_TIMESTAMP"]

  - source_table: "PATIENT_PATHOLOGICAL_CANCER_STAGE"
  - source_table: "PATIENT_TREATMENT"
    key_columns: ["START_TIMESTAMP", "END_TIMESTAMP"]

  # Trial Tables
  - source_table: "TRIAL"
    key_columns: ["NCT_ID", "PRMC_ID", "TRIAL_TITLE"]

  - source_table: "TRIAL_AGE"
    key_columns: ["AGE", "IS_NEGATION", "WEIGHT"]

  - source_table: "TRIAL_ARM"
    key_columns: ["ARM_LABEL", "START_DATE", "END_DATE", "MAXIMUM_PARTICIPANTS", "ENROLLED_PARTICIPANTS", "COMMENTS"]

  - source_table: "TRIAL_ARM_STATUS"
    key_columns: ["NAME"]

  - source_table: "TRIAL_CANCER_DIAGNOSIS"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_CANCER_STAGE"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_CONTACT"
    key_columns: ["FIRST_NAME", "LAST_NAME"]

  - source_table: "TRIAL_CONTACT_ASSIGNMENT"
  - source_table: "TRIAL_CONTACT_TYPE"
    key_columns: ["NAME"]

  - source_table: "TRIAL_ECOG_PERFORMANCE_STATUS"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_ETHNICITY"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_GENDER"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_INGEST_DATA_TYPE"
    key_columns: ["NAME"]

  - source_table: "TRIAL_INGEST_LOG"
  - source_table: "TRIAL_INGEST_SOURCE"
    key_columns: ["NAME"]

  - source_table: "TRIAL_LAB_RESULT"
    key_columns: ["WASHOUT_PERIOD_IN_DAYS", "IS_NEGATION"]

  - source_table: "TRIAL_LOCATION"
    key_columns: ["NAME", "CITY", "POSTAL_CODE", "IS_CCF_LOCATION"]

  - source_table: "TRIAL_LOCATION_ASSIGNMENT"
  - source_table: "TRIAL_NGS_CNV"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_NGS_FUSION"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_NGS_FUSION_GENE"
    key_columns: ["GENE_ORDER", "EXON_NUMBER", "REFSEQ"]

  - source_table: "TRIAL_NGS_GLOBAL_ALTERATION"
    key_columns: ["ASSAY_RESULT", "IS_NEGATION"]

  - source_table: "TRIAL_NGS_IHC"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_NGS_SNV"
    key_columns: ["EXON_NUMBER", "HGVSC", "HGVSP_SHORT", "INCLUDE_VUS", "IS_NEGATION"]

  - source_table: "TRIAL_PHASE"
    key_columns: ["NAME"]

  - source_table: "TRIAL_PHASE_ASSIGNMENT"
  - source_table: "TRIAL_PRIOR_TREATMENT"
    key_columns: ["WASHOUT_PERIOD_IN_DAYS", "IS_NEGATION"]

  - source_table: "TRIAL_RACE"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_SEX_ASSIGNED_AT_BIRTH"
    key_columns: ["IS_NEGATION"]

  - source_table: "TRIAL_TYPE"
    key_columns: ["NAME"]

  - source_table: "TRIAL_TYPE_ASSIGNMENT"

  # NGS Tables
  - source_table: "NGS_CNV"
    key_columns: ["NUMERIC_VALUE", "REFSEQ", "IS_VARIANT_OF_UNKNOWN_SIGNIFICANCE", "IS_WILD_TYPE", "IS_INHERITED", "IS_PATHOGENIC", "IS_ACTIONABLE", "IS_LOW_COVERAGE_AMPLICON"]

  - source_table: "NGS_CNV_RESULT"
    key_columns: ["NAME"]

  - source_table: "NGS_FUSION"
    key_columns: ["DESCRIPTION", "NO_CHANGE_DETECTED"]

  - source_table: "NGS_FUSION_GENE"
    key_columns: ["GENE_ORDER", "EXON_NUMBER", "REFSEQ", "CHROMOSOME", "START_POSITION", "STRAND"]

  - source_table: "NGS_GLOBAL_ALTERATION"
    key_columns: ["NUMERIC_VALUE"]

  - source_table: "NGS_GLOBAL_ALTERATION_TYPE"
    key_columns: ["NAME"]

  - source_table: "NGS_IHC"
    key_columns: ["INTENSITY", "PERCENTAGE"]

  - source_table: "NGS_IHC_RESULT"
    key_columns: ["NAME"]

  - source_table: "NGS_NCBI_BUILD"
    key_columns: ["NAME"]

  - source_table: "NGS_RNASEQ"
    key_columns: ["TPM"]

  - source_table: "NGS_SNV"
    key_columns: ["CHROMOSOME", "START_POSITION", "END_POSITION", "STRAND", "REFERENCE_ALLELE", "TUMOR_SEQ_ALLELE1", "TUMOR_SEQ_ALLELE2", "DBSNP_RS", "HGVSC", "HGVSP_SHORT", "EXON_NUMBER", "T_REF_COUNT", "T_ALT_COUNT", "REFSEQ", "VARIANT_ALLELE_FREQUENCY","GENOTYPE", "IS_VARIANT_OF_UNKNOWN_SIGNIFICANCE", "IS_WILD_TYPE", "IS_INHERITED", "IS_PATHOGENIC", "IS_ACTIONABLE", "IS_LOW_COVERAGE_AMPLICON"]

  - source_table: "NGS_SNV_CLASSIFICATION"
    key_columns: ["NAME"]

  - source_table: "NGS_SNV_TYPE"
    key_columns: ["NAME"]

  - source_table: "NGS_TEST_RESULT"
    key_columns: ["ACCESSION_NUMBER", "IS_QNS"]

  - source_table: "NGS_TEST_RESULT_METADATA"
  - source_table: "NGS_TEST_RESULT_METADATA_TYPE"
    key_columns: ["NAME"]

  # MUTATION_ANNOTATION Tables
  - source_table: "MUTATION_ANNOTATION_CARIS_720"
    key_columns: ["Hugo_Symbol", "Chromosome", "Start_Position", "End_Position", "Variant_Type", "Reference_Allele", "Tumor_Seq_Allele1", "Tumor_Seq_Allele2", "HGVSp_Short", "EXON"]

  - source_table: "MUTATION_ANNOTATION_CARIS_720_SILENT"
    key_columns: ["Hugo_Symbol", "Chromosome", "Start_Position", "End_Position", "Variant_Type", "Reference_Allele", "Tumor_Seq_Allele1", "Tumor_Seq_Allele2", "HGVSp_Short", "EXON"]

  - source_table: "MUTATION_ANNOTATION_CARIS_720_WHITELIST"
    key_columns: ["Hugo_Symbol", "Chromosome", "Start_Position", "End_Position", "Variant_Type", "Reference_Allele", "Tumor_Seq_Allele1", "Tumor_Seq_Allele2", "HGVSp_Short", "EXON"]

  - source_table: "MUTATION_ANNOTATION_CCF_BTC_GBM_MULTISITE_FFTS"
    key_columns: ["Hugo_Symbol", "Chromosome", "Start_Position", "End_Position", "Variant_Type", "Reference_Allele", "Tumor_Seq_Allele1", "Tumor_Seq_Allele2", "HGVSp_Short", "EXON"]

  - source_table: "MUTATION_ANNOTATION_CCF_BTC_LGG_FFTS"
    key_columns: ["Hugo_Symbol", "Chromosome", "Start_Position", "End_Position", "Variant_Type", "Reference_Allele", "Tumor_Seq_Allele1", "Tumor_Seq_Allele2", "HGVSp_Short", "EXON"]

  # Translation Tables
  - source_table: "TRANSLATE_ALTERNATE_TREATMENT_NAME"
    key_columns: ["ALTERNATE_TREATMENT_NAME"]

  - source_table: "TRANSLATE_CCF_ICDO_TO_ONCOTREE"
    key_columns: ["ICDO_TOPOGRAPHY_CODE", "ICDO_MORPHOLOGY_CODE", "ICDO_COMBINED", "ONCOTREE_CODE"]

  - source_table: "TRANSLATE_DISEASE_DESCRIPTION"
    key_columns: ["DISEASE_DESCRIPTION"]

  - source_table: "TRANSLATE_DISEASE_DESCRIPTION_CANCER_DIAGNOSIS"
  - source_table: "TRANSLATE_DISEASE_DESCRIPTION_DEFINITION"
  - source_table: "TRANSLATE_EDV_MEDICATION_TREATMENT"
    key_columns: ["MED_NAME"]

  - source_table: "TRANSLATE_HGVSP_AMINO_ACID_ABBREVIATION"
    key_columns: ["THREE_LETTER_ABBREVIATION", "ONE_LETTER_ABBREVIATION"]

  - source_table: "TRANSLATE_ICD_10_PREFIX_TO_ICD_O_PREFIX"
    key_columns: ["ICD_10_CODE_PREFIX", "ICD_O_SITE_CODE_PREFIX"]

  - source_table: "TRANSLATE_ICD_10_TO_ICD_O"
    key_columns: ["ICD_10_CODE", "ICD_O_SITE_CODE"]

  - source_table: "TRANSLATE_ONTOLOGY_TO_ONTOLOGY"
    key_columns: ["ONCOTREE_CODE", "NCIT_CODE", "UMLS_CODE", "ICDO_TOPOGRAPHY_CODE", "ICDO_MORPHOLOGY_CODE", "HEMEONC_CODE"]

  - source_table: "TRANSLATE_SOURCE_VARIANT_CLASSIFICATION"
    key_columns: ["SOURCE_VARIANT_CLASSIFICATION"]

  - source_table: "TRANSLATE_VARIANT_CLASSIFICATION_GROUP"
    key_columns: ["NAME"]

  # Treatment Tables
  - source_table: "TREATMENT"
    key_columns: ["NAME"]

  - source_table: "TREATMENT_TYPE"
    key_columns: ["NAME"]

  - source_table: "TREATMENT_TYPE_ASSIGNMENT"

  # Cancer Tables
  - source_table: "CANCER_DIAGNOSIS"
  - source_table: "CANCER_DIAGNOSIS_CRITERION"
  - source_table: "CANCER_DIAGNOSIS_SOURCE"
    key_columns: ["NAME"]

  - source_table: "CANCER_STAGE"
    key_columns: ["NAME"]

  - source_table: "CANCER_TYPE"
    key_columns: ["Case_ID", "PAT_ID"]

  - source_table: "ICD_O_MORPHOLOGY"
    key_columns: ["MORPHOLOGY_CODE", "BEHAVIOR_CODE", "DESCRIPTION"]

  - source_table: "ICD_O_SITE"
    key_columns: ["SITE_CODE", "DESCRIPTION"]

  - source_table: "ICD_O_SITE_PREFIX"
    key_columns: ["SITE_CODE_PREFIX", "DESCRIPTION"]

  - source_table: "REFERENCE_ONCOTREE_TUMOR_TYPE"
    key_columns: ["ONCOTREE_CODE", "DESCRIPTION", "CANCER_TYPE_DETAILED", "CANCER_TYPE", "TISSUE_TYPE", "PARENT"]

  - source_table: "ALTERNATE_GENE_SYMBOL"
    key_columns: ["SYMBOL"]

  - source_table: "ALTERNATE_GENE_SYMBOL_TYPE"
    key_columns: ["NAME"]

  - source_table: "ANCILLARY_TEST_RESULT"
  - source_table: "ANCILLARY_TEST_RESULT_METADATA"
  - source_table: "ANCILLARY_TEST_RESULT_METADATA_TYPE"
    key_columns: ["NAME"]

  - source_table: "BIOMARKER"
    key_columns: ["NAME"]

  - source_table: "BIOMARKER_GENE_ASSIGNMENT"
  - source_table: "CASE_META_LABVANTAGE_DATA"
    key_columns: ["study_id", "sample_id", "mrn", "first_name", "last_name", "gender", "legacy_id", "participant_id", "sample_type", "copath_case", "tissue_type", "quantity"]

  - source_table: "CASE_META_LABVANTAGE_SUMMARY"
    key_columns: ["study_id", "department_id", "security_department", "samples_count"]

  - source_table: "CBIOPORTAL_IDENTIFIER"
  - source_table: "COUNTRY"
    key_columns: ["NAME"]

  - source_table: "ECOG_PERFORMANCE_STATUS"
    key_columns: ["GRADE"]

  - source_table: "ETHNICITY"
    key_columns: ["NAME"]

  - source_table: "GENCODE_V43_GENE"
    key_columns: ["Hugo_Symbol", "Gene_Type", "Chromomosme", "Gene_Start", "Gene_End", "GENE_LENGTH", "EXON_LENGTH", "CDS_LENGTH"]

  - source_table: "GENDER"
    key_columns: ["NAME"]

  - source_table: "GENE"
    key_columns: ["HUGO_SYMBOL", "ENTREZ_ID"]

  - source_table: "LAB_RESULT_TYPE"
    key_columns: ["NAME"]

  - source_table: "MAGIC_ID_LOOKUP"
  - source_table: "NUMERIC_COMPARISON_TYPE"
    key_columns: ["CODE"]

  - source_table: "PANEL"
    key_columns: ["CODE", "NAME"]

  - source_table: "PANEL_VERSION"
    key_columns: ["VERSION"]

  - source_table: "PATHOLOGY_CASE"
    key_columns: ["CASE_NUMBER"]

  - source_table: "PIPELINE_LOG"
  - source_table: "PROTEIN_ALIAS"
    key_columns: ["NAME"]

  - source_table: "RACE"
    key_columns: ["NAME"]

  - source_table: "RNASEQ_TPM_CCF_BTC_GBM_MULTISITE_FFTS"
    key_columns: ["Hugo_Symbol", "Tumor_Sample_Barcode", "TPM"]

  - source_table: "RNASEQ_TPM_CCF_BTC_LGG_FFTS"
    key_columns: ["Hugo_Symbol", "Tumor_Sample_Barcode", "TPM"]

  - source_table: "RNASEQ_TPM_CCF_REIZES_OV_TEMPUS"
    key_columns: ["Hugo_Symbol", "Tumor_Sample_Barcode", "TPM"]

  - source_table: "SEX_ASSIGNED_AT_BIRTH"
    key_columns: ["NAME"]

  - source_table: "SOURCE"
    key_columns: ["NAME"]

  - source_table: "SOURCE_FILE_INGEST_LOG"
  - source_table: "SOURCE_FILE_TYPE"
    key_columns: ["NAME"]

  - source_table: "SPECIMEN"
    key_columns: ["SPEC_NUMBER_LN1", "PART"]

  - source_table: "SPECIMEN_BLOCK"
    key_columns: ["BLOCK"]

  - source_table: "SPECIMEN_SOURCE"
    key_columns: ["NAME"]

  - source_table: "SPECIMEN_TYPE"
    key_columns: ["NAME"]

  - source_table: "STATE"
    key_columns: ["NAME", "ABBREVIATION"]

  - source_table: "VITAL_STATUS"
    key_columns: ["NAME"]

# Validation Settings
validation_settings:
  output_dir: "database_validation_reports"

  # Maximum number of parallel workers
  max_workers: 2

  # Sample size for data validation (null or 0 = all data)
  sample_size: null

  data_validation_threshold:
    success: 99.0  # Threshold for success rate (percentage)
    warning: 95.0  # Threshold for warning (percentage)

  row_count_difference_threshold:
    success: 1.0   # Threshold for success rate (percentage)
    warning: 5.0   # Threshold for warning (percentage)

  # Enable/disable specific validation types
  enable_schema_validation: true
  enable_data_validation: true
  enable_constraint_validation: false  # Future feature

  # Timeout settings (seconds)
  query_timeout: 300
  connection_timeout: 30
